"""
Create a Bible reading plan with readings from the Psalms for each weekday.
"""

import calendar
import datetime

from bible_books import bible_books
from create_bible_plan import (
    get_weekday,
    get_weekday_delta,
    print_daily_reading,
    process_reading,
)
from create_daily_bible_reading_play_list import create_daily_bible_reading_play_list

bible_books_list = list(bible_books.keys())


def WeekdayPsalms(daily_readings, year):  # Weekday Worship (Psalms)

    weekday_psalm_readings = [
        "1",
        "2:1-6",
        "2:7-12",
        "3",
        "4",
        "5",
        "6",
        "7:1-9",
        "7:10-17",
        "8",
        "9:1-6",
        "9:7-12",
        "9:13-20",
        "10:1-8",
        "10:9-18",
        "11",
        "12:1-4",
        "12:5-8",
        "13",
        "14",
        "15",
        "16:1-6",
        "16:7-11",
        "17:1-7",
        "17:8-15",
        "18:1-19",
        "18:20-29",
        "18:30-50",
        "19:1-6",
        "19:7-14",
        "20",
        "21:1-7",
        "21:8-13",
        "22:1-21",
        "22:22-31",
        "23",
        "24",
        "25:1-7",
        "25:8-14",
        "25:15-22",
        "26",
        "27:1-6",
        "27:7-14",
        "28",
        "29",
        "30:1-5",
        "30:6-12",
        "31:1-8",
        "31:9-18",
        "31:19-24",
        "32:1-6",
        "32:7-11",
        "33:1-5",
        "33:6-11",
        "33:12-22",
        "34:1-10",
        "34:11-22",
        "35:1-10",
        "35:11-22",
        "35:23-28",
        "36",
        "37:1-11",
        "37:12-22",
        "37:23-34",
        "37:35-40",
        "38:1-9",
        "38:10-15",
        "38:16-22",
        "39:1-6",
        "39:7-13",
        "40:1-8",
        "40:9-17",
        "41",
        "42",
        "43",
        "44:1-8",
        "44:9-15",
        "44:16-26",
        "45:1-9",
        "45:10-17",
        "46:1-6",
        "46:7-11",
        "47",
        "48:1-7",
        "48:8-14",
        "49:1-11",
        "49:12-20",
        "50:1-6",
        "50:7-15",
        "50:16-23",
        "51:1-10",
        "51:11-19",
        "52",
        "53",
        "54",
        "55:1-6",
        "55:7-15",
        "55:16-23",
        "56",
        "57",
        "58",
        "59:1-9",
        "59:10-17",
        "60",
        "61",
        "62",
        "63",
        "64",
        "65:1-8",
        "65:9-13",
        "66:1-7",
        "66:8-20",
        "67",
        "68:1-17",
        "68:18-35",
        "69:1-18",
        "69:19-36",
        "70",
        "71:1-13",
        "71:14-24",
        "72:1-10",
        "72:11-19",
        "73:1-11",
        "73:12-22",
        "73:23-28",
        "74:1-11",
        "74:12-17",
        "74:18-23",
        "75",
        "76",
        "77:1-12",
        "77:13-20",
        "78:1-13",
        "78:14-27",
        "78:28-37",
        "78:38-50",
        "78:51-62",
        "78:63-72",
        "79:1-8",
        "79:9-13",
        "80:1-9",
        "80:10-19",
        "81:1-17",
        "81:8-16",
        "82",
        "83:1-8",
        "83:9-18",
        "84:1-7",
        "84:8-12",
        "85",
        "86:1-10",
        "86:11-17",
        "87",
        "88:1-9",
        "88:10-18",
        "89:1-14",
        "89:15-34",
        "89:35-52",
        "90:1-9",
        "90:10-17",
        "91:1-8",
        "91:9-16",
        "92:1-8",
        "92:9-15",
        "93",
        "94:1-13",
        "94:14-23",
        "95",
        "96:1-7",
        "96:8-13",
        "97",
        "98",
        "99",
        "100-101",
        "102:1-12",
        "102:13-22",
        "102:23-28",
        "103:1-12",
        "103:13-22",
        "104:1-12",
        "104:13-24",
        "104:25-35",
        "105:1-19",
        "105:20-37",
        "105:38-45;106:1-13",
        "106:14-31",
        "106:32-48",
        "107:1-24",
        "107:25-43",
        "108",
        "109:1-16",
        "109:17-31",
        "110",
        "111",
        "112:1-5",
        "112:6-10",
        "113",
        "114",
        "115:1-9",
        "115:10-18",
        "116:1-8",
        "116:9-19",
        "117;118:1-14",
        "118:15-29",
        "119:1-8",
        "119:9-16",
        "119:17-24",
        "119:25-40",
        "119:41-48",
        "119:49-54",
        "119:49-56",
        "119:57-72",
        "119:73-88",
        "119:88-96",
        "119:97-104",
        "119:105-112",
        "119:113-120",
        "119:121-136",
        "119:137-144",
        "119:145-160",
        "119:161-168",
        "119:172-176",
        "120",
        "121",
        "122",
        "123-124",
        "125",
        "126",
        "127",
        "128",
        "129",
        "130-131",
        "132",
        "133;134;135:1-12",
        "135:13-21",
        "136:1-12",
        "136:13-26",
        "137",
        "138",
        "139:1-8",
        "139:9-16",
        "139:17-24",
        "140",
        "141",
        "142",
        "143:1-6",
        "143:7-12",
        "144:1-8",
        "144:9-15",
        "145:1-8",
        "145:9-18",
        "145:19-21",
        "146",
        "147:1-11",
        "147:12-20",
        "148:1-6",
        "148:7-14",
        "149:1-5",
        "149:6-9",
        "150",
    ]

    date = datetime.datetime(year, 1, 1)  # January 1
    while date.strftime("%a") in ("Sat", "Sun"):
        date += datetime.timedelta(days=1)  # Increment until first weekday

    # TODO: Add needed extra readings.
    #       For years other than 2020, the readings themselves may need to be adjusted.
    # extra_readings = 0
    # if (get_weekday(datetime.datetime(year, 12, 31)) not in ('Sat', 'Sun')):
    #     extra_readings += 1  # Increment if December 31 is a weekday
    # if (calendar.isleap(year) and
    #     (get_weekday(datetime.datetime(year, 12, 30)) not in ('Sat', 'Sun'))):
    #     extra_readings += 1  # Increment if leap year & December 30 is a weekday
    # print(f'For {year}, {extra_readings} extra WeekdayPsalms() readings are needed.')

    for count, psalm_ref in enumerate(weekday_psalm_readings):
        datedelta = get_weekday_delta(date)
        (daily_readings, date) = process_reading(
            daily_readings, date, "Psa", psalm_ref, datedelta
        )

    return daily_readings


def main():
    daily_readings = {}
    YEAR = 2020
    WeekdayPsalms(daily_readings, YEAR)

    # for cal_date, full_refs in sorted(daily_readings.items()):
    #     print(cal_date, full_refs)  # Useful for debugging

    previous_month = ""
    for (cal_date, full_refs) in sorted(daily_readings.items()):
        # items() returns a list of (key, value) tuples
        previous_month = print_daily_reading(cal_date, previous_month, full_refs)
        create_daily_bible_reading_play_list(cal_date, full_refs)


if __name__ == "__main__":
    main()
